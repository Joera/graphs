<!DOCTYPE html>

<meta charset="UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="/assets/css/main.css">

<script src="/assets/scripts/d3.min.js"></script>
<script src="//d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="//d3js.org/topojson.v2.min.js"></script>
<script src="/assets/scripts/moment.min.js"></script>
<script src="/assets/scripts/main.js"></script>


<style>

    body {
        margin: 0;
    }

    iframe {
        border: none;
    }

</style>


<body id="inspiratiebord">

<header id="menu">

    <svg id="hamburger" width="52px" height="40px" viewBox="0 0 52 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M47.9,0 L4.1,0 C2.16700338,0 0.6,1.56700338 0.6,3.5 C0.6,5.43299662 2.16700338,7 4.1,7 L47.9,7 C49.8329966,7 51.4,5.43299662 51.4,3.5 C51.4,1.56700338 49.8329966,0 47.9,0 Z" id="Shape"></path>
        <path d="M47.9,16.5 L4.1,16.5 C2.16700338,16.5 0.6,18.0670034 0.6,20 C0.6,21.9329966 2.16700338,23.5 4.1,23.5 L47.9,23.5 C49.8329966,23.5 51.4,21.9329966 51.4,20 C51.4,18.0670034 49.8329966,16.5 47.9,16.5 Z" id="Shape"></path>
        <path d="M51.4,36.5 C51.4,34.5670034 49.8329966,33 47.9,33 L4.1,33 C2.16700338,33 0.6,34.5670034 0.6,36.5 C0.6,38.4329966 2.16700338,40 4.1,40 L47.9,40 C49.8329966,40 51.4,38.4329966 51.4,36.5 Z" id="Shape"></path>
    </svg>


    <ul>
        <li class="active" data-nav="vorige-week"><span>Vorige week</span></li>
        <li data-nav="besluiten"><span>Besluiten</span></li>
        <li data-nav="meldingen"><span>Meldingen</span></li>
        <li data-nav="schade-opnames"><span>Schade-opnames</span></li>
        <li data-nav="voortgang"><span>Voortgang</span></li>
        <li data-nav="schadevergoedingen"><span>Schadevergoedingen</span></li>
        <li data-nav="specials"><span>Specials</span></li>
        <li data-nav="reacties"><span>Reacties</span></li>

    </ul>

    <select class="muni-select">
        <option value="all" class="active"><span>Alle gemeenten</span></option>
        <option value="aa-en-hunze"><span>Aa en Hunze</span></option>
        <option value="appingedam"><span>Appingedam</span></option>
        <option value="assen"><span>Assen</span></option>
        <option value="delfzijl"><span>Delfzijl</span></option>
        <option value="emmen"><span>Emmen</span></option>
        <option value="groningen"><span>Groningen</span></option>
        <option value="het-hogeland"><span>Het Hogeland</span></option>
        <option value="loppersum"><span>Loppersum</span></option>
        <option value="midden-groningen"><span>Midden-Groningen</span></option>
        <option value="noordenveld"><span>Noordenveld</span></option>
        <option value="oldambt"><span>Oldambt</span></option>
        <option value="pekela"><span>Pekela</span></option>
        <option value="stadskanaal"><span>Stadskanaal</span></option>
        <option value="tynaarlo"><span>Tynaarlo</span></option>
        <option value="veendam"><span>Veendam</span></option>
        <option value="westerkwartier"><span>Westerkwartier</span></option>
        <option value="westerwolde"><span>Westerwolde</span></option>
    </select>
</header>


<main>

    <aside>
        <ul class="muni-select">
            <li data-value="all" class="active"><span>Alle gemeenten</span></li>
            <li data-value="aa-en-hunze"><span>Aa en Hunze</span></li>
            <li data-value="appingedam"><span>Appingedam</span></li>
            <li data-value="assen"><span>Assen</span></li>
            <li data-value="delfzijl"><span>Delfzijl</span></li>
            <li data-value="emmen"><span>Emmen</span></li>
            <li data-value="groningen"><span>Groningen</span></li>
            <li data-value="het-hogeland"><span>Het Hogeland</span></li>
            <li data-value="loppersum"><span>Loppersum</span></li>
            <li data-value="midden-groningen"><span>Midden-Groningen</span></li>
            <li data-value="noordenveld"><span>Noordenveld</span></li>
            <li data-value="oldambt"><span>Oldambt</span></li>
            <li data-value="pekela"><span>Pekela</span></li>
            <li data-value="stadskanaal"><span>Stadskanaal</span></li>
            <li data-value="tynaarlo"><span>Tynaarlo</span></li>
            <li data-value="veendam"><span>Veendam</span></li>
            <li data-value="westerkwartier"><span>Westerkwartier</span></li>
            <li data-value="westerwolde"><span>Westerwolde</span></li>
        </ul>
        <ul class="specials-select">
            <li data-value="all"><span>Alle specials</span></li>
            <li data-value="agro"><span>Agro</span></li>
            <li data-value="erfgoed"><span>Erfgoed</span></li>
            <li data-value="bedrijven"><span>Bedrijven</span></li>
            <li data-value="overig"><span>Overige specials</span></li>
        </ul>
    </aside>



    <section id="vorige-week" class="page">

        <article id="cijfer-nieuwe-meldingen" class="cijfer" data-script="CijfersLine"></article>

        <article id="map-nieuwe-meldingen" class="map mini-map" data-script="Map"></article>

        <article id="cijfer-nieuwe-opnames" class="cijfer" data-script="CijfersLine"></article>

        <article id="map-nieuwe-opnames" class="map mini-map" data-script="Map"></article>

        <article id="cijfer-nieuwe-besluiten" class="cijfer" data-script="CijfersLine"></article>

        <article id="map-nieuwe-besluiten" class="map mini-map" data-script="Map"></article>

        <article id="cijfer-nieuwe-afgehandeld" class="cijfer" data-script="CijfersLine"></article>

        <article id="map-nieuwe-afgehandeld" class="map mini-map" data-script="Map"></article>

        <article id="pie-toegekende-bedragen" class="pie mini-pie" data-script="PieChartSum"></article>

        <!--<article id="pie-bezwaren" class="pie mini-pie" data-script="PieChartSum"></article>-->

        <!--<article id="cijfer-nieuwe-aos-meldingen" class="cijfer" data-script="CijfersLine"></article>-->

        <!--<article id="cijfer-nieuwe-aos-gegrond" class="cijfer" data-script="CijfersLine"></article>-->


    </section>

    <section id="besluiten" class="page">

        <article id="multibar-besluiten" class="multibar" data-script="MultiBarProgression"></article>

        <article id="multibar-stuwmeerregeling" class="multibar" data-script="MultiBarProgression"></article>

        <article id="map-besluiten" class="map mini-map" data-script="Map"></article>

        <article id="map-stuwmeer-besluiten" class="map mini-map" data-script="Map"></article>

        <article id="pie-afgewezen" class="pie mini-pie" data-script="PieChartSum"></article>

        <article id="trend-afgewezen" data-script="TrendLine"></article>

        <article id="ontwikkeling-afgewezen" data-script="MultiBarWithIncrement"></article>

    </section>

    <section id="meldingen" class="page">

        <!--<article id="bars-schade-meldingen" data-script="BarProgression" data-property="schademeldingen">-->
            <!--<h3>Schade-meldingen</h3>-->
            <!--<div class="container"></div>-->
        <!--</article>-->

        <!--<article id="bars-aos-meldingen" data-script="BarProgression" data-property="aos_meldingen">-->
            <!--<h3>AOS meldingen</h3>-->
            <!--<div class="container"></div>-->
        <!--</article>-->

        <!--<article id="map-schade-meldingen" class="map" data-script="Gemeentes" data-property="schademeldingen">-->
            <!--<div class="container"></div>-->
        <!--</article>-->



    </section>


    <section id="schade-opnames" class="page">

        <!--<article id="taart-opnames">-->
            <!--<h3>Soort opname</h3>-->
            <!--<div class="container"></div>-->
        <!--</article>-->

    </section>


    <section id="voortgang" class="page">


    </section>



    <section id="schadevergoedingen" class="page">



    </section>

</main>


</body>

<script>

    d3.json(window.location + '/config.json', function(error, json) {

        console.log(json);

        let config = json;

        let page = 'vorige-week';
        let segment = 'all';
        let graphs = [];

        let municipalityDropdown = document.querySelector('select.muni-select');
        let municipalityOptions = [].slice.call(document.querySelectorAll('ul.muni-select li'));
        let specialOptions = [].slice.call(document.querySelectorAll('.specials-select option'));
        let segmentOptions = municipalityOptions.concat(specialOptions);
        let menuOptions = [].slice.call(document.querySelectorAll('#menu ul li'));
        let pages = [].slice.call(document.querySelectorAll('section.page'));

        let openPage = function openPage(pageName) {

            for (let page of pages) {

                if (page.id === pageName) {

                    page.style.display = (window.innerWidth < 600) ? 'flex' : 'grid';

                    for (let vis of [].slice.call(page.querySelectorAll('article'))) {

                        let container = document.createElement('div');
                        container.classList.add('container');

                        if(config[vis.id].smallMultiple) {
                            container.classList.add('small_multiple');
                        }

                        vis.appendChild(container);

                        // clear html in containers
                        vis.querySelector('.container').innerHTML = '';

                        console.log(config[vis.id]);

                        graphs[vis.id] = new window[vis.getAttribute('data-script')](config[vis.id].api,vis.querySelector('.container'), config[vis.id], config[vis.id].dataMapping, segment, vis.getAttribute('data-property'),true);
                        graphs[vis.id].init();

                        if (config[vis.id].header) {

                            if (vis.querySelector('.article_header')) { vis.querySelector('.article_header').remove() }

                            let headerContainer = document.createElement('div');
                            headerContainer.classList.add('article_header');

                            let h = document.createElement('h3');
                            h.innerText = (typeof config[vis.id].header === 'string') ? config[vis.id].header : config[vis.id].dataMapping[0].label;

                            headerContainer.appendChild(h);

                            for (let i = 0; i < 3; i++) {

                                let span = document.createElement('span');
                                headerContainer.appendChild(span);
                            }

                            vis.querySelector('.container').parentNode.prepend(headerContainer);
                        }

                        // uniformize props in function --> window[method](el,dataMapping,property,segment,smallMultiple)
                 //       window[vis.getAttribute('data-script')](vis.querySelector('.container'),dataMapping[vis.id],vis.getAttribute('data-property'),true);
                    }

                } else {

                    page.style.display = 'none';
                }
            }
        }

        let changeSegment = function changeSegment(newSegment) {

            segment = newSegment;

            for (let graph of Object.values(graphs)) {
                // what do we do with data?

            //    console.log(graph);

                if (graph.endpoint === "/api/data" ) {

                    graph.run(newSegment,true)
                }
            }
        }

        menuOptions.forEach( (o) => {

            o.addEventListener( 'click', () => {

                menu(true);
                openPage(o.getAttribute('data-nav'));
            });
        });

        segmentOptions.forEach( (o) => {

            o.addEventListener( 'change', () => {

                changeSegment(o.getAttribute('data-value'));
            });
        });

        municipalityDropdown.addEventListener( 'change', () => {

            changeSegment(municipalityDropdown.value);
        });

        // one call per gemeente

        d3.json('https://tcmg-hub.publikaan.nl/api/gemeenten', function(error, json) {
            if (error) throw error;
            globalData.geoData = topojson.feature(json, json.objects.gemeenten).features;

            d3.json('https://tcmg-hub.publikaan.nl/api/gemeentes', function (error, json) {
                if (error) throw error;
                globalData.gemeentes = json;

                d3.json('https://tcmg-hub.publikaan.nl/api/data', function (error, json) {
                    if (error) throw error;
                    globalData.data = json;
                    openPage(page);
                });
            });
        });

        let menu = function(close) {

            if (close) {

                document.querySelector('#menu').classList.remove('open');

            } else {

                document.querySelector('#menu').classList.toggle('open');
            }
        }

        document.querySelector('#hamburger').addEventListener( 'click', () => {

            menu();
        });

    });

</script>

</html>